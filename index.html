<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Product Admin - Dashboard HTML Template</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
    <!-- https://fonts.google.com/specimen/Roboto -->
    <link rel="stylesheet" href="css/fontawesome.min.css">
    <!-- https://fontawesome.com/ -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="css/templatemo-style.css">
    <!--
	Product Admin CSS Template
	https://templatemo.com/tm-524-product-admin
	-->
</head>

<body id="reportsPage">

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <!-- https://jquery.com/download/ -->
    <script src="js/moment.min.js"></script>
    <!-- https://momentjs.com/ -->
    <script src="js/Chart.min.js"></script>
    <!-- http://www.chartjs.org/docs/latest/ -->
    <script src="js/bootstrap.min.js"></script>
    <!-- https://getbootstrap.com/ -->
    <script src="js/tooplate-scripts.js"></script>
    <link rel="stylesheet" href="css/model_popup.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>


    <div class="" id="home">
        <nav class="navbar navbar-expand-xl">
            <div class="container h-100">
                <a class="navbar-brand" href="/">
                    <h1 class="tm-site-title mb-0">Product Admin</h1>
                </a>
                <button class="navbar-toggler ml-auto mr-0" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-bars tm-nav-icon"></i>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mx-auto h-100">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">
                                <i class="fas fa-tachometer-alt"></i>
                                Dashboard
                                <span class="sr-only">(current)</span>
                            </a>
                        </li>
                        <li class="nav-item dropdown">

                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                                <i class="far fa-file-alt"></i>
                                <span>
                                    Reports <i class="fas fa-angle-down"></i>
                                </span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="allupcomingPM.html">All Upcoming Maintenance</a>
                                <a class="dropdown-item" href="completedPM.html">Completed Maintenance</a>
                            </div>
                        </li>

<!--
                        <li class="nav-item">
                            <a class="nav-link" href="products.html">
                                <i class="fas fa-shopping-cart"></i>
                                Products
                            </a>
                        </li>
-->
                        <li class="nav-item">
                            <a class="nav-link" href="accounts.html">
                                <i class="far fa-user"></i>
                                Accounts
                            </a>
                        </li>

               
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-cog"></i>
                                <span>
                                    Menu<i class="fas fa-angle-down"></i>
                                </span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <!-- 
                                <a class="dropdown-item" href="add-product.html">Add Stock</a>
                                <a class="dropdown-item" href="products.html">View Stock</a>
                                <a class="dropdown-item" href="add-customer-info.html">Add Customer</a>
                    -->
                                <a class="dropdown-item" href="view-customer-info.html">View Customers</a>
                                <a class="dropdown-item" href="schedulePM.html">Add Maintenace Request</a>
                            </div>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link d-block" href="login.html">
                                <b>Logout</b>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

        </nav>
        <div class="container">
            <div class="row">
                <div class="col">
                    <p class="text-white mt-5 mb-5"style="font-size:160%;" > <b>Status Report </b></p>
                </div>                  
            </div>
            <div class="row">
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary btn-block " style="border: 2px solid white; background-color: #54657d; margin: 0 8px;  " onclick="loadData('1')">Today</button>
                    <button type="submit" class="btn btn-primary btn-block " style="border: 2px solid white; background-color: #54657d; margin: 0 8px;  " onclick="loadData('2')">This Month</button>
                    <button type="submit" class="btn btn-primary btn-block " style="border: 2px solid white; background-color: #54657d; margin: 0 8px;  " onclick="loadData('0')">Show All</button>
                </div>
            </div>
            <br>
            <br>
            <!-- row -->
            <div class="row tm-content-row">

                <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 tm-block-col">

                    <div class="tm-product-table-container">
                        <table id= "stockTable" class="table table-hover tm-table-small tm-product-table">
                          <thead>
                            <tr>
                              <th scope="col">Status ID</th>
                              <th scope="col">Date</th>
                              <th scope="col">Name</th>
                              <th scope="col">Status</th>
                            </tr>
                          </thead>
                          <tbody>
                            
                          </tbody>
                        </table>
                      </div>


                      <div id="inventoryDiv" class="modal-container" style = "font-size: 62.5%;">
              
                        <div id="myCarousel" class="carousel slide" data-ride="carousel">
                            <ul id="imageIndicator" class="carousel-indicators">
                              
                            </ul>
                            <div id="imageList" class="carousel-inner">
                              
                            </div>
                            <a class="carousel-control-prev" href="#myCarousel" data-slide="prev">
                              <span class="carousel-control-prev-icon"  style="background-color:#D1CCFF;"></span>
                            </a>
                            <a class="carousel-control-next" href="#myCarousel" data-slide="next">
                              <span class="carousel-control-next-icon"  style="background-color:#D1CCFF;" ></span>
                            </a>
                          </div>
          
                       <a href="#stockTable" class="link-2"></a>
                    </div>

          
                </div>
            </div>



        </div>
        <footer class="tm-footer row tm-mt-small">
            <div class="col-12 font-weight-light">
                <p class="text-center text-white mb-0 px-4 small">
                    Copyright &copy; <b>2021</b> All rights reserved.
                </p>
            </div>
        </footer>
    </div>


    <script>

        function getDate(inputDate, flag)
          {
            //var today = new Date();
            if (flag == 1)
            {
              inputDate.setDate(inputDate.getDate() - 30);
            }
            var dd = inputDate.getDate();
            var mm = inputDate.getMonth()+1; 
            var yyyy = inputDate.getFullYear();
            if(dd<10) 
            {
                dd='0'+dd;
            } 
  
            if(mm<10) 
            {
                mm='0'+mm;
            } 
            var today = dd+'/'+mm+'/'+yyyy;
            return today;
        }

        function loadData(flag) {
            $.ajax({
              type: 'GET',
              url: "/getStatusDetail",
              contentType: "text/plain",
              dataType: 'json',
              success: function (data) {
                myJsonData = data;
                if(flag == "0")
                  populateDataTable(myJsonData);
                else if(flag == "1")
                  populateDataTableToday(myJsonData);
                else if(flag == "2")
                  populateDataTableMonth(myJsonData);
              },
              error: function (e) {
                console.log("There was an error with your request...");
                console.log("error: " + JSON.stringify(e));
              }
            });
          }
        
        // populate the data table with JSON data
        function populateDataTable(data) {
            console.log("populating data table for all data");
            // clear the table before populating it with more data
            $("#stockTable").DataTable().clear().draw();
            var length = Object.keys(data).length;
            for(var i = 0; i < length; i++) {
              // You could also use an ajax property on the data table initialization
              $('#stockTable').dataTable().fnAddData( [
                data[i].statusID,
                data[i].date,
                data[i].name,
                data[i].status,
              ]);
            }
          }

          function populateDataTableMonth(data) {
            var previousDate = getDate(new Date(), 1);
            console.log("populating data table for this month");
            // clear the table before populating it with more data
            $("#stockTable").DataTable().clear().draw();
            var length = Object.keys(data).length;
            for(var i = 0; i < length; i++) {


                var dateParts = previousDate.split("/");
                // month is 0-based, that's why we need dataParts[1] - 1
                var oldDate = new Date(+dateParts[2], dateParts[1] - 1, +dateParts[0]); 

                dateParts = data[i].date.split("/")
                var dbDate = new Date(+dateParts[2], dateParts[1] - 1, +dateParts[0]); 

              console.log(oldDate);
              console.log(dbDate);
              if((dbDate > oldDate))
              {
                  console.log(dbDate + " lies within a month");
                  // You could also use an ajax property on the data table initialization
                  $('#stockTable').dataTable().fnAddData( [
                  data[i].statusID,
                  data[i].date,
                  data[i].name,
                  data[i].status,
                  ]);
              }
            }
          }

          function populateDataTableToday(data) {
            var todaysDate = getDate(new Date(), 0);
            console.log("populating data table for today");
            console.log(todaysDate);
            // clear the table before populating it with more data
            $("#stockTable").DataTable().clear().draw();
            var length = Object.keys(data).length;
            for(var i = 0; i < length; i++) {
                console.log(data[i].date);
                if(todaysDate == data[i].date)
                {
                      // You could also use an ajax property on the data table initialization
                      $('#stockTable').dataTable().fnAddData( [
                      data[i].statusID,
                      data[i].date,
                      data[i].name,
                      data[i].status,
                      ]);
                }
            }
          }

        $(function() {
          //$("#stockTable").DataTable();

          $('#stockTable').dataTable( {
            "columnDefs": [
                { "width": "10%", "targets": [0,1,2] }
            ]
            } );

          loadData("1");
          document.getElementById("inventoryDiv").style.opacity = "0";
        });


        function loadImages(statusid) {
          $.ajax({
            type: 'GET',
            data: { statusID: statusid },
            url: "/getStatusImages",
            contentType: "text/plain",
            dataType: 'json',
            success: function (data) {
              myJsonData = data;
              console.log("error: " + JSON.stringify(myJsonData));
              populateInventoryTable(myJsonData);
            },
            error: function (e) {
              console.log("There was an error with your request...");
              console.log("error: " + JSON.stringify(e));
            }
          });
          location.href = "#inventoryDiv";
        //$("#custInventory").DataTable().clear();
        //loadInventoryData(cutomerID);
        
          document.getElementById("inventoryDiv").style.opacity = "1";
        }

        // populate the data table with JSON data
        function populateInventoryTable(data) {
          console.log("populating data table...");
          
          document.getElementById("imageList").innerHTML = "";
          
          var response = '',
            indicator = '';
            for (var i = 0; i < data.length; i++) {
                response += '<div class="carousel-item"><img src="' + data[i].imageLink + '" width="500" height="500"><div class="carousel-caption"><h3 style="color:Green;">' + data[i].statusID + '</div></div>';
                indicator += '<li data-target="#myCarousel" data-slide-to="'+i+'"></li>';
            }
            $('#imageList').append(response);
            $('#imageIndicator').append(indicator);
            $('.carousel-item').first().addClass('active');
            $('.carousel-indicators > li').first().addClass('active');
            $("#myCarousel").carousel();

        }


      //var table = $("#stockTable").DataTable();
      $('#stockTable tbody').on('click', 'tr', function () {
        var data = $("#stockTable").DataTable().row( this ).data();
        console.log(data)
        //alert( 'You clicked on '+data[0]+'\'s row' );
        loadImages(data[0])
    })

  
    </script>



</body>

</html>