
       <!--Table and divs that hold the pie charts-->
    <table class="columns">
      <tr>
        <td><div id="piechart_div" style="border: 1px solid #ccc"></div></td>
        <td><div id="barchart_div" style="border: 1px solid #ccc"></div></td>
      </tr>
    </table>


    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Add Product - Home HTML Template</title>
        <link
          rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:400,700"
        />
        <!-- https://fonts.google.com/specimen/Roboto -->
        <link rel="stylesheet" href="css/fontawesome.min.css" />
        <!-- https://fontawesome.com/ -->
        <!-- http://api.jqueryui.com/datepicker/ -->
        <link rel="stylesheet" href="css/bootstrap.min.css" />
        <!-- https://getbootstrap.com/ -->
        <link rel="stylesheet" href="css/templatemo-style.css">
        <!--
      Product Admin CSS Template
      https://templatemo.com/tm-524-product-admin
      -->
      </head>
    
      <body>
        <nav class="navbar navbar-expand-xl">
          <div class="container h-100">
            <img src="img/logo.png" alt="Rspowerlogo" width="80" height="80">
            <button
              class="navbar-toggler ml-auto mr-0"
              type="button"
              data-toggle="collapse"
              data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <i class="fas fa-bars tm-nav-icon"></i>
            </button>
    
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav mx-auto h-100">
                <li class="nav-item">
                  <a class="nav-link" href="/">
                    <i class="fas fa-tachometer-alt"></i> Home
                    <span class="sr-only">(current)</span>
                  </a>
                </li>
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    id="navbarDropdown"
                    role="button"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <i class="far fa-file-alt"></i>
                    <span> Reports <i class="fas fa-angle-down"></i> </span>
                  </a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="allupcomingPM.html">All Upcoming Maintenance</a>
                    <a class="dropdown-item" href="completedPM.html">Completed Maintenance</a>
                    
                    <div id = "hideReport" style ="display:none">
                      <a class="dropdown-item" href="generateMaintenanceReport.html">Generate Maintenance Report</a>
                      <a class="dropdown-item" href="generateStatusReport.html">Generate Status Report</a>
                    </div>
                    
                  </div>
                </li>

                <li class="nav-item">
                  <a class="nav-link" href="accounts.html">
                    <i class="far fa-user"></i> Account
                  </a>
                </li>
    
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    id="navbarDropdown"
                    role="button"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <i class="fas fa-cog"></i>
                    <span> Menu <i class="fas fa-angle-down"></i> </span>
                  </a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <!-- 
                    <a class="dropdown-item" href="add-product.html">Add Stock</a>
                    <a class="dropdown-item" href="products.html">View Stock</a>
                    <a class="dropdown-item" href="add-customer-info.html">Add Customer</a>
            -->
                    <a class="dropdown-item" href="view-customer-info.html">View Customers</a>
                    <div id = "hideMenu" style ="display:none">
                      <a class="dropdown-item" href="schedulePM.html">Add Maintenance Request</a>
                      <a class="dropdown-item" href="add-customer-info.html">Add Customer</a>
                      <a class="dropdown-item" href="deleteUpcomingPM.html">Delete Maintenance Request</a>
                      <a class="dropdown-item" href="editPMTicket.html">Edit Maintenance Request</a>
                    </div>
                    <div id = "showAdminOnly" style ="display:none">
                      <a class="dropdown-item" href="addNewEmployee.html">Add New Employee</a>
                    </div>
                </div>
                </li>
              </ul>
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link d-block" href="login.html">
                    <b>Logout</b>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
        <div class="container tm-mt-big tm-mb-big">

          <div class="col-xl-6 col-lg-6 col-md-12">
              <form  id = "myform" action="javascript:;" enctype=”multipart/form-data” onsubmit="loadData()" class="tm-edit-product-form" >

                      <div class="row">
                              <!---
                              <button type="submit" class="btn btn-primary btn-block " style="border: 2px solid white; background-color: #54657d; margin: 0 8px;  " onclick="loadData('1')">Today</button>
                              <button type="submit" class="btn btn-primary btn-block " style="border: 2px solid white; background-color: #54657d; margin: 0 8px;  " onclick="loadData('2')">This Month</button>
                              <button type="submit" class="btn btn-primary btn-block " style="border: 2px solid white; background-color: #54657d; margin: 0 8px;  " onclick="loadData('0')">Show All</button>
                          
                              -->
                              
                                  <div class="form-group mb-3 col-xs-12 col-sm-6">
                                  <label
                                      for="startDate"
                                      >Start Date
                                  </label>
                                  <input class="form-control validate"  type="date" id="startDate" name="statusDate" required>
                                  </div>

                                  <div class="form-group mb-3 col-xs-12 col-sm-6">
                                      <label
                                      for="endDate"
                                      >End Date
                                      </label>
                                      <input class="form-control validate"  type="date" id="endDate" name="statusDate" required>
                                  </div>
                          
                          
                          
                      </div>

                      <div class="row">
                        <div class="form-group mb-3 col-xs-12 col-sm-6">
                        <button type="submit"  id = "submitbutton" class="btn btn-primary btn-block text-uppercase">Generate Report</button>
                        </div>
                    </div>

                </form>

          </div>

              <div class="row" id="chartContainer">

                <canvas id="myChart" style="width:50%;max-width:530px"></canvas>

                <canvas id="myChart1" style="width:50%;max-width:530px"></canvas>

                </div>
          </div>
        </div>
        <footer class="tm-footer row tm-mt-small">
            <div class="col-12 font-weight-light">
              <p class="text-center text-white mb-0 px-4 small">
                Copyright &copy; <b>RSPower Solutions 2022</b> All rights reserved. 
            </p>
            </div>
        </footer> 
    
        <script async src="js/jquery-3.3.1.min.js"></script>
        <!-- https://jquery.com/download/ -->

        <!-- https://jqueryui.com/download/ -->
        <script async src="js/bootstrap.min.js"></script>

         <!-- charts js by google,   https://developers.google.com/chart/interactive/docs/basic_multiple_charts -->
        
         <script async src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"> </script>


        <script>

          

        function loadData() {


          var sdate = new Date(document.getElementById("myform").elements.startDate.value);
          var edate = new Date(document.getElementById("myform").elements.endDate.value);

          sdate.setUTCHours(0,0,0,0);
          edate.setUTCHours(23,59,59,999);


                    $.ajax({
                    type: 'GET',
                    data: { startDate:sdate,
                            endDate: edate},
                    url: "/generatePMHistoryReport",
                    contentType: "text/plain",
                    dataType: 'json',
                    success: function (data) {
                    myJsonData = data;
                    drawChart(myJsonData);
                    },
                    error: function (e) {
                    console.log("There was an error with your request...");
                    console.log("error: " + JSON.stringify(e));
                    }
                });


        }

        function drawChart(data)
        {

            var total_travel = 0;
            var total_transport = 0;
            var total_miscellaneous = 0;

            var total_maintenance = 0;
            var total_call = 0;
            var total_installation = 0;



            var length = Object.keys(data).length;
            for (var i = 0; i < length; i++) {

              total_travel += data[i].travelExpense;
              total_transport += data[i].transportExpense;
              total_miscellaneous += data[i].MiscellaneousExpense;


              if(data[i].issueType == "CALL")
              {
                total_call=total_call + 1;
              }
              else if(data[i].issueType == "MAINTENANCE")
              {
                total_maintenance = total_maintenance + 1;
              }
              else if( data[i].issueType == "INSTALLATION")
              {
                total_installation = total_installation + 1;
              }



            }

            // Expense chart code--
                  var xValues = ["Travel", "Transport", "Miscellaneous"];
                  var yValues = [];
                  var barColors = [
                      "#b91d47",
                      "#2b5797",
                      "#1e7145"
                    ];

                  //order of entry is impotant
                  yValues.push(total_travel);
                  yValues.push(total_transport);
                  yValues.push(total_miscellaneous);


                  $('#myChart').remove(); // this is my <canvas> element
                  $('#chartContainer').append('<canvas id="myChart" style="width:50%;max-width:530px"></canvas>');


                  new Chart("myChart", {
                    type: "pie",
                    data: {
                      labels: xValues,
                      datasets: [{
                        backgroundColor: barColors,
                        data: yValues
                      }]
                    },
                    options: {
                      title: {
                        display: true,
                        fontColor: 'white',
                        text: "Expense Distribution"
                      },
                      legend: {
                        labels: {
                            fontColor: 'white'
                        }
                    }

                    }
                  });



        // IssueType  chart code--
                  var xValues1 = ["Maintenance", "Call", "Installation"];
                  var yValues1 = [];
                  var barColors1 = [
                      "#b91d47",
                      "#2b5797",
                      "#1e7145"
                    ];

                  //order of entry is impotant
                  yValues1.push(total_maintenance);
                  yValues1.push(total_call);
                  yValues1.push(total_installation);


                  $('#myChart1').remove(); // this is my <canvas> element
                  $('#chartContainer').append('<canvas id="myChart1" style="width:50%;max-width:530px"></canvas>');


                  new Chart("myChart1", {
                    type: "pie",
                    data: {
                      labels: xValues1,
                      datasets: [{
                        backgroundColor: barColors1,
                        data: yValues1
                      }]
                    },
                    options: {
                      title: {
                        display: true,
                        fontColor: 'white',
                        text: "Issue Distribution"
                      },
                      legend: {
                        labels: {
                            fontColor: 'white'
                        }
                    }

                    }
                  });


        }


        </script>
      </body>
    </html>