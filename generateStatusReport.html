<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Product Admin - Home HTML Template</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
    <!-- https://fonts.google.com/specimen/Roboto -->
    <link rel="stylesheet" href="css/fontawesome.min.css">
    <!-- https://fontawesome.com/ -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="css/templatemo-style.css">
    <link rel="stylesheet" href="css/model_popup.css">
    <!--
	Product Admin CSS Template
	https://templatemo.com/tm-524-product-admin
	-->
</head>

<body id="reportsPage">

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <!-- https://jquery.com/download/ -->
    <script src="js/moment.min.js"></script>


    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

    <!-- https://momentjs.com/ -->
    <script src="js/Chart.min.js"></script>
    <!-- http://www.chartjs.org/docs/latest/ -->
    <script src="js/bootstrap.min.js"></script>
    <!-- https://getbootstrap.com/ -->
    <script src="js/tooplate-scripts.js"></script>
    <link rel="stylesheet" href="css/model_popup.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>


     <!-- for sorting based on date -->
    <script src="https://cdn.datatables.net/plug-ins/1.10.11/sorting/datetime-moment.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    

    <div class="" id="home">
        <nav class="navbar navbar-expand-xl">
            <div class="container h-100">
                <img src="img/logo.png" alt="Rspowerlogo" width="80" height="80">
                <button class="navbar-toggler ml-auto mr-0" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-bars tm-nav-icon"></i>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mx-auto h-100">
                        <li class="nav-item">
                            <a class="nav-link active" href="/">
                                <i class="fas fa-tachometer-alt"></i>
                                Home
                                <span class="sr-only">(current)</span>
                            </a>
                        </li>
                        <li class="nav-item dropdown">

                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                                <i class="far fa-file-alt"></i>
                                <span>
                                    Reports <i class="fas fa-angle-down"></i>
                                </span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="allupcomingPM.html">All Upcoming Maintenance</a>
                                <a class="dropdown-item" href="completedPM.html">Completed Maintenance</a>
                               
                                <div id = "hideReport" style ="display:none">
                                    <a class="dropdown-item" href="generateMaintenanceReport.html">Generate Maintenance Report</a>
                                    <a class="dropdown-item" href="generateStatusReport.html">Generate Status Report</a>
                                    <a class="dropdown-item" href="reportCharts.html">Generate Charts</a>
                                </div>
                  
                            </div>
                        </li>

<!--
                        <li class="nav-item">
                            <a class="nav-link" href="products.html">
                                <i class="fas fa-shopping-cart"></i>
                                Products
                            </a>
                        </li>
-->
                        <li class="nav-item">
                            <a class="nav-link" href="accounts.html">
                                <i class="far fa-user"></i>
                                Account
                            </a>
                        </li>

               
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-cog"></i>
                                <span>
                                    Menu<i class="fas fa-angle-down"></i>
                                </span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <!-- 
                                <a class="dropdown-item" href="add-product.html">Add Stock</a>
                                <a class="dropdown-item" href="products.html">View Stock</a>
                                <a class="dropdown-item" href="add-customer-info.html">Add Customer</a>
                    -->
                                <a class="dropdown-item" href="view-customer-info.html">View Customers</a>
                                <div id = "hideMenu" style ="display:none">
                                    <a class="dropdown-item" href="schedulePM.html">Add Maintenance Request</a>
                                    <a class="dropdown-item" href="add-customer-info.html">Add Customer</a>
                                    <a class="dropdown-item" href="deleteUpcomingPM.html">Delete Maintenance Request</a>
                                    <a class="dropdown-item" href="editPMTicket.html">Edit Maintenance Request</a>
                                  </div>
                                  <div id = "showAdminOnly" style ="display:none">
                                    <a class="dropdown-item" href="addNewEmployee.html">Add New Employee</a>
                                  </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link d-block" href="login.html">
                                <b>Logout</b>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

        </nav>
        <div class="row">
            <div class="col">
                <p class="text-white mt-5 mb-2"style="font-size:160%; text-align:center" > <b>Generate Status Report </b></p>
            </div>                  
        </div>

        <div class="container">

            <div class="tm-bg-primary-dark tm-block tm-block-h-auto">
                <div class="row tm-edit-product-row">
                    <div class="col-xl-6 col-lg-6 col-md-12">

                        <form  id = "myform" action="javascript:;" enctype=”multipart/form-data” onsubmit="loadData()" class="tm-edit-product-form" >


                        <div class="row">
                                <!---
                                <button type="submit" class="btn btn-primary btn-block " style="border: 2px solid white; background-color: #54657d; margin: 0 8px;  " onclick="loadData('1')">Today</button>
                                <button type="submit" class="btn btn-primary btn-block " style="border: 2px solid white; background-color: #54657d; margin: 0 8px;  " onclick="loadData('2')">This Month</button>
                                <button type="submit" class="btn btn-primary btn-block " style="border: 2px solid white; background-color: #54657d; margin: 0 8px;  " onclick="loadData('0')">Show All</button>
                            
                                -->
                                
                                    <div class="form-group mb-3 col-xs-12 col-sm-6">
                                    <label
                                        for="startDate"
                                        >Start Date
                                    </label>
                                    <input class="form-control validate"  type="date" id="startDate" name="statusDate" required>
                                    </div>

                                    <div class="form-group mb-3 col-xs-12 col-sm-6">
                                        <label
                                        for="endDate"
                                        >End Date
                                        </label>
                                        <input class="form-control validate"  type="date" id="endDate" name="statusDate" required>
                                    </div>
                            
                            
                            
                        </div>


                        <div class="row">
                            <div class="form-group mb-3 col-xs-12 col-sm-6">
                            <label
                                for="userName"
                                >Employee name
                            </label>
                            <select
                            class="custom-select tm-select-accounts"
                            id="userName"
                            name="userName"
                            >
                            <option value="">Select Employee</option>
                            </select>
                            </div>
                        </div>


                        <div class="row">
                            <div class="form-group mb-3 col-xs-12 col-sm-6">
                            <button type="submit"  id = "submitbutton" class="btn btn-primary btn-block text-uppercase">Generate Report</button>
                            </div>
                        </div>

                        </form>

                    </div>
                </div>
            </div>


            <br>
            <br>
            <!-- row -->
            <div class="row tm-content-row">

                <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 tm-block-col">

                    <div class="tm-product-table-container">
                        <table id= "stockTable" class="table table-hover tm-table-small tm-product-table">
                          <thead>
                            <tr>
                              <th scope="col">Status ID</th>
                              <th scope="col">Date</th>
                              <th scope="col">Name</th>
                              <th scope="col">Status</th>
                            </tr>
                          </thead>
                          <tbody>
                            
                          </tbody>
                        </table>
                      </div>


                      <div id="inventoryDiv" class="modal-container" style = "font-size: 62.5%;">
              
                        <div id="myCarousel" class="carousel slide" data-ride="carousel">
                            <ul id="imageIndicator" class="carousel-indicators">
                              
                            </ul>
                            <div id="imageList" class="carousel-inner">
                              
                            </div>
                            <a class="carousel-control-prev" href="#myCarousel" data-slide="prev">
                              <span class="carousel-control-prev-icon"  style="background-color:#D1CCFF;"></span>
                            </a>
                            <a class="carousel-control-next" href="#myCarousel" data-slide="next">
                              <span class="carousel-control-next-icon"  style="background-color:#D1CCFF;" ></span>
                            </a>
                          </div>
          
                       <a href="#stockTable" class="link-2"></a>
                    </div>

          
                </div>
            </div>



        </div>
        <footer class="tm-footer row tm-mt-small">
            <div class="col-12 font-weight-light">
                <p class="text-center text-white mb-0 px-4 small">
                    Copyright &copy; <b>2021</b> All rights reserved.
                </p>
            </div>
        </footer>
    </div>


    <script>



        $(function() {

                $.ajax({
                    type: "GET",
                    url: "/getAllEngineers",
                    dataType: "json",
                    global: false,
                    success: function (result, status, xhr) {
                    $.each(result,function(key, value)
                    {
                        $("#userName").append('<option value="' + value.userName + '">' + value.userName + '</option>');
                    });
                    },
                    error: function (xhr, status, error) {
                        alert("Result: " + status + " " + error + " " + xhr.status + " " + xhr.statusText)
                    }
                });

                $.ajax({
                    type: 'GET',
                    url: "/whoami",
                    contentType: "text/plain",
                    global: false,
                    dataType: 'json',
                    success: function (resposeJson) {

                        if(resposeJson.message == "admin" || resposeJson.message == "coordinator" )
                        {
                            document.getElementById("hideReport").style.display = "block";
                            document.getElementById("hideMenu").style.display = "block";

                            if(resposeJson.message == "admin")
                            {
                            document.getElementById("showAdminOnly").style.display = "block";
                            }
                            
                        }
                        else if (resposeJson.message == "engineer")
                        {
                            document.getElementById("hideReport").style.display = "none";
                            document.getElementById("hideMenu").style.display = "none";
                        }
                        else
                        {
                            window.location.href = "/login.html";
                        }
                    },
                    error: function (e) {
                    console.log("Error while adding data: " + JSON.stringify(e))
                    document.getElementById("hideReport").style.display = "none";
                    document.getElementById("hideMenu").style.display = "none";
                    }
                });
 
        });

        function getDate(inputDate)
          {
            var dd = inputDate.getDate();
            var mm = inputDate.getMonth()+1; 
            var yyyy = inputDate.getFullYear();
            if(dd<10) 
            {
                dd='0'+dd;
            } 
  
            if(mm<10) 
            {
                mm='0'+mm;
            } 
            var today = dd+'/'+mm+'/'+yyyy;
            return today;
        }

        function loadData() {

            var sdate = new Date(document.getElementById("myform").elements.startDate.value);
            var edate = new Date(document.getElementById("myform").elements.endDate.value);

            sdate.setUTCHours(0,0,0,0);
            edate.setUTCHours(23,59,59,999);

            if(document.getElementById("myform").elements.userName.value == "")
            {
                $.ajax({
                type: 'GET',
                data: { startDate:sdate,
                        endDate: edate},
                url: "/getStatusDetailDates",
                contentType: "text/plain",
                dataType: 'json',
                success: function (data) {
                    myJsonData = data;
                    populateDataTable(myJsonData);
                },
                error: function (e) {
                    console.log("There was an error with your request...");
                    console.log("error: " + JSON.stringify(e));
                }
                });
            }
            else
            {
                $.ajax({
                type: 'GET',
                data: { name : document.getElementById("myform").elements.userName.value,
                        startDate:sdate,
                        endDate: edate},
                url: "/generateStatusReport_D_E",
                contentType: "text/plain",
                dataType: 'json',
                success: function (data) {
                    myJsonData = data;
                    populateDataTable(myJsonData);
                },
                error: function (e) {
                    console.log("There was an error with your request...");
                    console.log("error: " + JSON.stringify(e));
                }
                });
                
            }

          }
        
        // populate the data table with JSON data
        function populateDataTable(data) {

            console.log("populating data table for all data");
            // clear the table before populating it with more data
            $("#stockTable").DataTable().clear().draw();

            var length = Object.keys(data).length;
            for(var i = 0; i < length; i++) {
              //var statusDate =new Date(data[i].date).toLocaleDateString();
              var statusDate = moment(data[i].date).format('LL');
              // You could also use an ajax property on the data table initialization
              $('#stockTable').dataTable().fnAddData( [
                data[i].statusID,
                statusDate,
                data[i].name,
                data[i].status,
              ]);
            }
            
          }


        

        $(function() {
          //$("#stockTable").DataTable();


          $('#stockTable').dataTable( {
            "columnDefs": [
                { "width": "10%", "targets": [0,1] },
                { "width": "15%", "targets": [2,3] },
                { "target": "1", "type": 'datetime-moment'}
            ],
            dom: 'Blfrtip',
            buttons: [
                 'excel', 'pdf'
            ],
            "aaSorting": [[ 1, 'asc' ]], 
            } );
          document.getElementById("inventoryDiv").style.opacity = "0";

          $.fn.dataTable.moment( 'LL' );


        });


        function loadImages(statusid) {
          $.ajax({
            type: 'GET',
            data: { statusID: statusid },
            url: "/getStatusImages",
            contentType: "text/plain",
            dataType: 'json',
            success: function (data) {
              myJsonData = data;
              console.log("error: " + JSON.stringify(myJsonData));
              populateInventoryTable(myJsonData);
            },
            error: function (e) {
              console.log("There was an error with your request...");
              console.log("error: " + JSON.stringify(e));
            }
          });
          location.href = "#inventoryDiv";
        //$("#custInventory").DataTable().clear();
        //loadInventoryData(cutomerID);
        
          document.getElementById("inventoryDiv").style.opacity = "1";
        }

        // populate the data table with JSON data
        function populateInventoryTable(data) {
          console.log("populating data table...");
          
          document.getElementById("imageList").innerHTML = "";
          
          var response = '',
            indicator = '';
            for (var i = 0; i < data.length; i++) {
                response += '<div class="carousel-item"><img src="' + data[i].imageLink + '" width="500" height="500"><div class="carousel-caption"><h3 style="color:Green;">' + data[i].statusID + '</div></div>';
                indicator += '<li data-target="#myCarousel" data-slide-to="'+i+'"></li>';
            }
            $('#imageList').append(response);
            $('#imageIndicator').append(indicator);
            $('.carousel-item').first().addClass('active');
            $('.carousel-indicators > li').first().addClass('active');
            $("#myCarousel").carousel();

        }


      //var table = $("#stockTable").DataTable();
      $('#stockTable tbody').on('click', 'tr', function () {
        var data = $("#stockTable").DataTable().row( this ).data();
        console.log(data)
        //alert( 'You clicked on '+data[0]+'\'s row' );
        loadImages(data[0])
    })

  
    </script>



</body>

</html>